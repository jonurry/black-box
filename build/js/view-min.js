"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t,n){function o(e){if(l){var t,n,r,s;s=document.getElementById("svg"),null!==s&&(r=a(s.querySelectorAll("path")),r.length>0&&(n=r.map(function(e){var t=e.getTotalLength();return e.style.strokeDasharray=t+" "+t,e.style.strokeDashoffset=t,e.style.visibility="visible",.03*Math.pow(t,.5)}),t=0,r[0].getBoundingClientRect(),e&&r.forEach(function(e,o){e.style.transition=e.style.WebkitTransition="stroke-dashoffset "+n[o]+"s "+t+"s ease-in-out",e.style.strokeDashoffset="0",t+=n[o]+.1}))),i=setTimeout(o,1e4,!e)}}function r(e,t){var n=e.path.length,o,r,s,u=[],a,c,i,l;if(n>2){a=100/t,c=a/2,o=e.path[0],i=o.position.row,l=o.position.column,u.push("M"),0===l?u.push(0):l===t+1?u.push(100):u.push((l-.5)*a),0===i?u.push(0):i===t+1?u.push(100):u.push((i-.5)*a);for(var p=1;p<e.path.length-1;p++)r=e.path[p],s=e.path[p+1],1===r.direction.rowIncrement&&1===s.direction.rowIncrement?(u.push("v"),u.push(a)):-1===r.direction.rowIncrement&&-1===s.direction.rowIncrement?(u.push("v"),u.push(-a)):1===r.direction.columnIncrement&&1===s.direction.columnIncrement?(u.push("h"),u.push(a)):-1===r.direction.columnIncrement&&-1===s.direction.columnIncrement?(u.push("h"),u.push(-a)):-1===r.direction.columnIncrement&&1===s.direction.rowIncrement?(u.push("a"),u.push(c),u.push(c),u.push(0),u.push(0),u.push(0),u.push(-c),u.push(c)):1===r.direction.rowIncrement&&1===s.direction.columnIncrement?(u.push("a"),u.push(c),u.push(c),u.push(0),u.push(0),u.push(0),u.push(c),u.push(c)):1===r.direction.columnIncrement&&-1===s.direction.rowIncrement?(u.push("a"),u.push(c),u.push(c),u.push(0),u.push(0),u.push(0),u.push(c),u.push(-c)):-1===r.direction.rowIncrement&&-1===s.direction.columnIncrement?(u.push("a"),u.push(c),u.push(c),u.push(0),u.push(0),u.push(0),u.push(-c),u.push(-c)):1===r.direction.columnIncrement&&1===s.direction.rowIncrement?(u.push("a"),u.push(c),u.push(c),u.push(0),u.push(0),u.push(1),u.push(c),u.push(c)):1===r.direction.rowIncrement&&-1===s.direction.columnIncrement?(u.push("a"),u.push(c),u.push(c),u.push(0),u.push(0),u.push(1),u.push(-c),u.push(c)):-1===r.direction.columnIncrement&&-1===s.direction.rowIncrement?(u.push("a"),u.push(c),u.push(c),u.push(0),u.push(0),u.push(1),u.push(-c),u.push(-c)):-1===r.direction.rowIncrement&&1===s.direction.columnIncrement&&(u.push("a"),u.push(c),u.push(c),u.push(0),u.push(0),u.push(1),u.push(c),u.push(-c))}return u.join(" ")}function s(e,o,r){var s=!(arguments.length>3&&arguments[3]!==n)||arguments[3],u=t.SHOOT_RAY_OUTCOME,a,c,i;switch(a=document.getElementsByTagName("svg")[0],c=document.createElement("path"),c.setAttribute("d",e),c.style.visibility=s?"visible":"hidden",""!==r&&c.setAttribute("class",r),o){case u.ABSORBED:case u.REFLECTED:-1===a.innerHTML.search(c.outerHTML)?a.innerHTML+=c.outerHTML:a.innerHTML=a.innerHTML.replace(c.outerHTML,"");break;case u.PROPOGATED:i=a.querySelectorAll("path."+r)[0],i===n?a.innerHTML+=c.outerHTML:i.remove();break}}function u(){var e,t,n,o,r,s,u;null!==(r=document.getElementById("svg"))&&(e=document.getElementById("blackbox"),t=parseInt(document.getElementById("inputGridSize").value),o=e.offsetWidth/(t+2),u=e.offsetWidth-2*o,s=e.offsetTop+o,n=o+e.offsetLeft,r.style.cssText="width: "+u+"px; top: "+s+"px; left: "+n+"px;")}function a(e){return Array.prototype.slice.call(e)}function c(){this.view=this,this.validationHandlers(),this.bind("resizeBlackBox")}var i,l=function(){var e=document.createElement("div");return e.innerHTML="<svg/>","http://www.w3.org/2000/svg"==(e.firstChild&&e.firstChild.namespaceURI)}();document.documentElement.className+=l?" inline-svg":"",c.prototype.bind=function(e,n){var o,r,s,a,c,i,l,p,d,h;"animateRays"===e?(p=document.getElementById("radioAnimateRaysYes"),p.addEventListener("change",function(){n()}),p=document.getElementById("radioAnimateRaysNo"),p.addEventListener("change",function(){n()})):"newGame"===e?(r=document.getElementById("buttonNewGame"),r.addEventListener("click",function(){i=parseInt(document.getElementById("inputGridSize").value),l=parseInt(document.getElementById("inputMarbles").value),n(i,l),document.getElementById("score").style.display="none",document.getElementById("animateRays").style.display="none"})):"scoreGame"===e?(s=document.getElementById("buttonScoreGame"),s.addEventListener("click",function(){h=n(),document.getElementById("scoreValue").innerHTML=h,document.getElementById("score").style.display="block",document.getElementById("animateRays").style.display="block"})):"shootRay"===e?(o=document.getElementById("blackbox"),o.addEventListener("click",function(e){a=e.target,"svg"!==a.nodeName&&(d=parseInt(a.dataset.pos.split(",")[0]),c=parseInt(a.dataset.pos.split(",")[1]),n(new t.Vector(d,c)))})):"resizeBlackBox"===e&&window.addEventListener("resize",u)},c.prototype.renderAndAnimateAllRays=function(e,n){var u=t.SHOOT_RAY_OUTCOME,c,l,p,d;return c="on"===document.querySelector('input[name="switch"]:checked').value,c?(p=document.getElementById("svg"),null!==p&&(l=a(p.querySelectorAll("path")),0===l.length&&e.forEach(function(e){var t;switch(e.outcome){case u.ABSORBED:t="hit";break;case u.MARBLE_PLACED:case u.MARBLE_REMOVED:t="guess";break;case u.PROPOGATED:t="ray-"+e.rayNumber;break;case u.REFLECTED:t="reflect";break}d=r(e,n),d.length>0&&s(d,e.outcome,t,!1)})),o(!0)):clearTimeout(i),c},c.prototype.renderGridConsole=function(e){var t;console.log();for(var n=0;n<e.length;n++){t="";for(var o=0;o<e.length;o++)t+=String(e[n][o])+"\t";console.log(t+"\t"+String(n))}},c.prototype.renderGrid=function(e,t,n,o,r,s){var a=document.getElementById("blackbox"),c,i,l,p=t+1;a.innerHTML="",a.className="blackbox grid grid-size-"+t;for(var d=0;d<=p;d++)for(var h=0;h<=p;h++){switch(i=document.createElement("div"),l=["cell"],e[d][h]){case 0:break;case"a":l.push("hit");break;case"n":l.push("guess-wrong");break;case"r":l.push("reflect");break;case"x":l.push("not-found");break;case"y":l.push("guess-right");break;default:0!==d&&d!==p&&0!==h&&h!==p||l.push("ray-"+e[d][h])}n&&s.forEach(function(t){parseInt(t.row)===d&&parseInt(t.column)===h&&0===e[d][h]&&l.push("guess")}),i.dataset.pos=d+","+h,i.className=l.join(" "),a.appendChild(i)}n&&(a.innerHTML+='<svg id="svg" viewBox="0 0 100 100"></svg>',window.setTimeout(u,0)),c=document.getElementById("buttonScoreGame"),c.disabled=!(o&&!n)},c.prototype.renderShot=function(e,n,o,u){var a=t.SHOOT_RAY_OUTCOME,c,i="",l,p,d,h,m;switch(h=e.path[0].position.row+","+e.path[0].position.column,p=e.path[e.path.length-1].position.row+","+e.path[e.path.length-1].position.column,d=document.querySelectorAll("[data-pos='"+h+"']")[0],l=document.querySelectorAll("[data-pos='"+p+"']")[0],c=document.getElementById("buttonScoreGame"),e.outcome){case a.ABSORBED:i="hit";break;case a.MARBLE_PLACED:case a.MARBLE_REMOVED:i="guess";break;case a.PROPOGATED:i="ray-"+e.rayNumber;break;case a.REFLECTED:i="reflect";break}if(o)m=r(e,n),m.length>0&&s(m,e.outcome,i);else switch(i=" "+i,e.outcome){case a.ABSORBED:case a.MARBLE_PLACED:case a.PROPOGATED:case a.REFLECTED:d.className+=i,e.outcome===a.PROPOGATED&&(l.className+=i);break;case a.MARBLE_REMOVED:d.className=d.className.replace(i,"");break}c.disabled=!(u&&!o)},c.prototype.validationHandlers=function(){var e=document.getElementById("inputGridSize"),t=document.getElementById("inputMarbles");e.addEventListener("focusout",function(e){var t=parseInt(e.currentTarget.value);t<6?e.currentTarget.value=6:t>16?e.currentTarget.value=16:isNaN(t)&&(e.currentTarget.value=8)}),t.addEventListener("focusout",function(e){var t=parseInt(document.getElementById("inputGridSize").value),n=parseInt(e.currentTarget.value);n<4?e.currentTarget.value=4:n>16?e.currentTarget.value=16:isNaN(n)&&(e.currentTarget.value=t-4)})},"function"==typeof define&&define.amd||("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports.BlackBoxView=c:(e=e||{},e.BLACKBOX=e.BLACKBOX||{},e.BLACKBOX.View=c))}(void 0,(void 0).BLACKBOX);