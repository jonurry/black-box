"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))){if(void 0===(void 0).BLACKBOX&&((void 0).BLACKBOX={}),void 0===(void 0).BLACKBOX.VECTOR){var vectorModule=require("../js/vector.js");(void 0).BLACKBOX.VECTOR=vectorModule.VECTOR}if(void 0===(void 0).BLACKBOX.utility){var utilModule=require("../js/utility.js");(void 0).BLACKBOX.utility=utilModule.blackBoxUtil}}!function(i,e){function o(i,o,t){var r=!1,n=!1,s=i.position.row+i.direction.rowIncrement,u=i.position.column+i.direction.columnIncrement,a=t+1,c=e.VECTOR.DIRECTION,h;return 0===s||s===a||0===u||u===a?h=E.NONE:i.direction===c.UP||i.direction===c.DOWN?(r=o.some(function(i){return i.row===s&&i.column===u+1}),n=o.some(function(i){return i.row===s&&i.column===u-1}),r&&n?(i.direction=i.direction===c.UP?c.DOWN:c.UP,h=E.REVERSED):r?(i.direction=c.LEFT,h=E.DEFLECTED):n?(i.direction=c.RIGHT,h=E.DEFLECTED):h=E.NONE):(r=o.some(function(i){return i.row===s+1&&i.column===u}),n=o.some(function(i){return i.row===s-1&&i.column===u}),r&&n?(i.direction=i.direction===c.LEFT?c.RIGHT:c.LEFT,h=E.REVERSED):r?(i.direction=c.UP,h=E.DEFLECTED):n?(i.direction=c.DOWN,h=E.DEFLECTED):h=E.NONE),h}function t(i,e){i.length=0;for(var o=0;o<e+2;o++)i[o]=[],i[o].length=e+2}function r(i,e){for(var o=0;o<e+2;o++)i[o].fill(0)}function n(i,e,o,t){var r={};r.row=i,r.column=e,t.length<o&&(t.some(function(i){return i.row===r.row&&i.column===r.column})||t.push(r))}function s(i,o,t){for(var r,n=0;n<o;n++){r={};do{r.row=e.utility.getRandomIntInclusive(1,i),r.column=e.utility.getRandomIntInclusive(1,i)}while(t.some(function(i){return i.row===r.row&&i.column===r.column}));t.push(r)}}function u(i,e){return 0!==e[i.position.row][i.position.column]}function a(i,e){var o={};return o.row=i.position.row+i.direction.rowIncrement,o.column=i.position.column+i.direction.columnIncrement,e.some(function(i){return i.row===o.row&&i.column===o.column})}function c(i,e){var o=i.position.row,t=i.position.column,r=e+1;return 0===o||o===r||0===t||t===r}function h(i,e){var o=i.position.row,t=i.position.column,r=e+1;return 0===o&&0===t||0===o&&t===r||o===r&&0===t||o===r&&t===r}function d(i,e){var o=i.position.row,t=i.position.column,r=e+1;return o>0&&t>0&&o<r&&t<r}function l(i,e){var o=i.position.row,t=i.position.column,r=e+1;return o<0||t<0||o>r||t>r}function m(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.gameHasFinished=!1,this.grid=[],this.gridSize=i,this.guesses=[],this.marbles=[],this.numberOfMarbles=e,this.numberOfRays=0,this.turns=[],o&&this.newGame(this.gridSize,this.numberOfMarbles)}var f={ABSORBED:"ray hit marble and was absorbed",CORNER:"ray is in a corner",DUPLICATE:"ray has already been shot",INSIDE:"ray is inside the black box",MARBLE_MAX:"marble ignored - maximum number already placed",MARBLE_PLACED:"marble has been placed",MARBLE_REMOVED:"marble has been removed",NOTHING:"no outcome",OUTSIDE:"ray is outside of the black box",PROPOGATED:"ray has reached the rim",REFLECTED:"ray has been reflected"},E={DEFLECTED:"ray has been deflected",NONE:"ray has not been deflected",REVERSED:"ray has been reversed"};m.prototype.allMarblesPlaced=function(){return this.guesses.length===this.numberOfMarbles},m.prototype.guess=function(i){for(var e=i.position.row,o=i.position.column,t=-1,r=0,n;n=this.guesses[r];r++)n.row===e&&n.column===o&&(t=r);return t>-1?(this.guesses.splice(t,1),f.MARBLE_REMOVED):this.guesses.length<this.numberOfMarbles?(this.guesses.push(i.position),f.MARBLE_PLACED):f.MARBLE_MAX},m.prototype.newGame=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;this.gameHasFinished=!1,this.grid=[],this.gridSize=i,this.guesses=[],this.marbles=[],this.numberOfMarbles=e,this.numberOfRays=0,this.turns=[],t(this.grid,this.gridSize),r(this.grid,this.gridSize),s(this.gridSize,this.numberOfMarbles,this.marbles)},m.prototype.scoreGame=function(){var i,e;if(this.allMarblesPlaced()){e=0;for(var o=1;o<=this.gridSize;o++)0!==this.grid[0][o]&&e++,0!==this.grid[this.gridSize+1][o]&&e++,0!==this.grid[o][0]&&e++,0!==this.grid[o][this.gridSize+1]&&e++;this.guesses.forEach(function(i){this.marbles.some(function(e){return e.row===i.row&&e.column===i.column})?this.grid[i.row][i.column]="y":(e+=5,this.grid[i.row][i.column]="n")},this);for(var t=1;t<=this.gridSize;t++)for(var r=1;r<=this.gridSize;r++)1===this.grid[t][r]&&(this.grid[t][r]="x");this.gameHasFinished=!0}else i=this.numberOfMarbles-this.guesses.length,e="Make "+i.toString()+" more guess"+(1===i?"":"es")+" to get a score",this.gameHasFinished=!1;return e},m.prototype.shootRay=function(i){var t={outcome:f.NOTHING,path:[],rayNumber:0},r,n=E.NONE,s=i.position.row,m=i.position.column,p=this.grid,O=this.gridSize,g=O+1,y=this.marbles,b=this.gameHasFinished,R=e.VECTOR.DIRECTION;if(i.direction===R.NONE&&(0===i.position.row?i.direction=R.DOWN:i.position.row===g?i.direction=R.UP:0===i.position.column?i.direction=R.RIGHT:i.position.column===g&&(i.direction=R.LEFT)),t.path.push(JSON.parse(JSON.stringify(i))),l(i,O))t.outcome=f.OUTSIDE;else if(h(i,O))t.outcome=f.CORNER;else if(d(i,O))this.gameHasFinished?t.outcome=f.INSIDE:t.outcome=this.guess(i);else if(u(i,p)&&!this.gameHasFinished)t.outcome=f.DUPLICATE;else do{a(i,y)?(this.gameHasFinished||(p[s][m]="a"),t.path.push(JSON.parse(JSON.stringify(i))),t.outcome=f.ABSORBED):(r=JSON.stringify(i),(n=o(i,y,O))!==E.NONE&&(1===t.path.length?(this.gameHasFinished||(p[s][m]="r"),t.outcome=f.REFLECTED):n===E.REVERSED&&(t.path.push(JSON.parse(r)),t.path.push(JSON.parse(JSON.stringify(i)))))),t.outcome===f.NOTHING&&(i.move(),t.path.push(JSON.parse(JSON.stringify(i))),c(i,O)&&(i.position.row===s&&i.position.column===m?(this.gameHasFinished||(p[s][m]="r"),t.outcome=f.REFLECTED):(this.gameHasFinished||(this.numberOfRays++,p[i.position.row][i.position.column]=this.numberOfRays,p[s][m]=this.numberOfRays),t.outcome=f.PROPOGATED)))}while(t.outcome===f.NOTHING);return b?t.rayNumber=p[s][m]:(t.rayNumber=this.numberOfRays,t.outcome!==f.ABSORBED&&t.outcome!==f.REFLECTED&&t.outcome!==f.PROPOGATED||this.turns.push(t)),t},"function"==typeof define&&define.amd||("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?(module.exports.SHOOT_RAY_OUTCOME=f,module.exports.BlackBoxModel=m,"test"===process.env.NODE_ENV&&(module.exports.BlackBoxModel._private={checkForDeflectedRay:o,createGrid:t,initialiseGrid:r,placeMarbleOnGrid:n,placeMarblesRandomlyOnGrid:s,rayAlreadyShot:u,rayHasHitMarble:a,rayHasRechedRim:c,rayIsInCorner:h,rayIsInsideGrid:d,rayIsOutsideGrid:l})):(i=i||{},i.BLACKBOX=i.BLACKBOX||{},i.BLACKBOX.SHOOT_RAY_OUTCOME=f,i.BLACKBOX.Model=m))}(void 0,(void 0).BLACKBOX);