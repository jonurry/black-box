if(function(e){"use strict";var t={getRandomIntInclusive:function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}};"function"==typeof define&&define.amd||("object"==typeof exports?module.exports.blackBoxUtil=t:(e=e||{},e.BLACKBOX=e.BLACKBOX||{},e.BLACKBOX.utility=t))}(this),function(e,t){"use strict";function n(e,n,o){this.direction=o!==t?o:i.DIRECTION.NONE,this.position={row:parseInt(e,10),column:parseInt(n,10)}}var i={};i.DIRECTION={UP:{rowIncrement:-1,columnIncrement:0},DOWN:{rowIncrement:1,columnIncrement:0},LEFT:{rowIncrement:0,columnIncrement:-1},RIGHT:{rowIncrement:0,columnIncrement:1},NONE:{rowIncrement:0,columnIncrement:0}},n.prototype.move=function(){try{var e=this.direction.rowIncrement,t=this.direction.columnIncrement;Number.isInteger(e)&&Number.isInteger(t)&&e>=-1&&e<=1&&t>=-1&&t<=1&&(this.position.row+=e,this.position.column+=t)}catch(e){throw"The vector direction was not a valid direction."}},n.prototype.setPosition=function(e,t){this.position.row=e,this.position.column=t},"function"==typeof define&&define.amd||("object"==typeof exports?(module.exports.VECTOR=i,module.exports.Vector=n):(e=e||{},e.BLACKBOX=e.BLACKBOX||{},e.BLACKBOX.VECTOR=i,e.BLACKBOX.Vector=n))}(this),"object"==typeof exports){if(void 0===this.BLACKBOX&&(this.BLACKBOX={}),void 0===this.BLACKBOX.VECTOR){var vectorModule=require("../js/vector.js");this.BLACKBOX.VECTOR=vectorModule.VECTOR}if(void 0===this.BLACKBOX.utility){var utilModule=require("../js/utility.js");this.BLACKBOX.utility=utilModule.blackBoxUtil}}!function(e,t){"use strict";function n(e,n,i){var o=!1,r=!1,s=e.position.row+e.direction.rowIncrement,a=e.position.column+e.direction.columnIncrement,u=i+1,c=t.VECTOR.DIRECTION,l;return 0===s||s===u||0===a||a===u?l=f.NONE:e.direction===c.UP||e.direction===c.DOWN?(o=n.some(function(e){return e.row===s&&e.column===a+1}),r=n.some(function(e){return e.row===s&&e.column===a-1}),o&&r?(e.direction=e.direction===c.UP?c.DOWN:c.UP,l=f.REVERSED):o?(e.direction=c.LEFT,l=f.DEFLECTED):r?(e.direction=c.RIGHT,l=f.DEFLECTED):l=f.NONE):(o=n.some(function(e){return e.row===s+1&&e.column===a}),r=n.some(function(e){return e.row===s-1&&e.column===a}),o&&r?(e.direction=e.direction===c.LEFT?c.RIGHT:c.LEFT,l=f.REVERSED):o?(e.direction=c.UP,l=f.DEFLECTED):r?(e.direction=c.DOWN,l=f.DEFLECTED):l=f.NONE),l}function i(e,t){e.length=0;for(var n=0;n<t+2;n++)e[n]=[],e[n].length=t+2}function o(e,t){for(var n=0;n<t+2;n++)e[n].fill(0)}function r(e,t,n,i){var o={};o.row=e,o.column=t,i.length<n&&(i.some(function(e){return e.row===o.row&&e.column===o.column})||i.push(o))}function s(e,n,i){for(var o,r=0;r<n;r++){o={};do{o.row=t.utility.getRandomIntInclusive(1,e),o.column=t.utility.getRandomIntInclusive(1,e)}while(i.some(function(e){return e.row===o.row&&e.column===o.column}));i.push(o)}}function a(e,t){return 0!==t[e.position.row][e.position.column]}function u(e,t){var n={};return n.row=e.position.row+e.direction.rowIncrement,n.column=e.position.column+e.direction.columnIncrement,t.some(function(e){return e.row===n.row&&e.column===n.column})}function c(e,t){var n=e.position.row,i=e.position.column,o=t+1;return 0===n||n===o||0===i||i===o}function l(e,t){var n=e.position.row,i=e.position.column,o=t+1;return 0===n&&0===i||0===n&&i===o||n===o&&0===i||n===o&&i===o}function h(e,t){var n=e.position.row,i=e.position.column,o=t+1;return n>0&&i>0&&n<o&&i<o}function d(e,t){var n=e.position.row,i=e.position.column,o=t+1;return n<0||i<0||n>o||i>o}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.gameHasFinished=!1,this.grid=[],this.gridSize=e,this.guesses=[],this.marbles=[],this.numberOfMarbles=t,this.numberOfRays=0,this.turns=[],n&&this.newGame(this.gridSize,this.numberOfMarbles)}var p={ABSORBED:"ray hit marble and was absorbed",CORNER:"ray is in a corner",DUPLICATE:"ray has already been shot",INSIDE:"ray is inside the black box",MARBLE_MAX:"marble ignored - maximum number already placed",MARBLE_PLACED:"marble has been placed",MARBLE_REMOVED:"marble has been removed",NOTHING:"no outcome",OUTSIDE:"ray is outside of the black box",PROPOGATED:"ray has reached the rim",REFLECTED:"ray has been reflected"},f={DEFLECTED:"ray has been deflected",NONE:"ray has not been deflected",REVERSED:"ray has been reversed"};m.prototype.allMarblesPlaced=function(){return this.guesses.length===this.numberOfMarbles},m.prototype.guess=function(e){for(var t=e.position.row,n=e.position.column,i=-1,o=0,r;r=this.guesses[o];o++)r.row===t&&r.column===n&&(i=o);return i>-1?(this.guesses.splice(i,1),p.MARBLE_REMOVED):this.guesses.length<this.numberOfMarbles?(this.guesses.push(e.position),p.MARBLE_PLACED):p.MARBLE_MAX},m.prototype.newGame=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;this.gameHasFinished=!1,this.grid=[],this.gridSize=e,this.guesses=[],this.marbles=[],this.numberOfMarbles=t,this.numberOfRays=0,this.turns=[],i(this.grid,this.gridSize),o(this.grid,this.gridSize),s(this.gridSize,this.numberOfMarbles,this.marbles)},m.prototype.scoreGame=function(){var e,t;if(this.allMarblesPlaced()){t=0;for(var n=1;n<=this.gridSize;n++)0!==this.grid[0][n]&&t++,0!==this.grid[this.gridSize+1][n]&&t++,0!==this.grid[n][0]&&t++,0!==this.grid[n][this.gridSize+1]&&t++;this.guesses.forEach(function(e){this.marbles.some(function(t){return t.row===e.row&&t.column===e.column})?this.grid[e.row][e.column]="y":(t+=5,this.grid[e.row][e.column]="n")},this);for(var i=1;i<=this.gridSize;i++)for(var o=1;o<=this.gridSize;o++)1===this.grid[i][o]&&(this.grid[i][o]="x");this.gameHasFinished=!0}else e=this.numberOfMarbles-this.guesses.length,t="Make "+e.toString()+" more guess"+(1===e?"":"es")+" to get a score",this.gameHasFinished=!1;return t},m.prototype.shootRay=function(e){var i={outcome:p.NOTHING,path:[],rayNumber:0},o,r=f.NONE,s=e.position.row,m=e.position.column,E=this.grid,g=this.gridSize,y=g+1,O=this.marbles,v=this.gameHasFinished,B=t.VECTOR.DIRECTION;if(e.direction===B.NONE&&(0===e.position.row?e.direction=B.DOWN:e.position.row===y?e.direction=B.UP:0===e.position.column?e.direction=B.RIGHT:e.position.column===y&&(e.direction=B.LEFT)),i.path.push(JSON.parse(JSON.stringify(e))),d(e,g))i.outcome=p.OUTSIDE;else if(l(e,g))i.outcome=p.CORNER;else if(h(e,g))this.gameHasFinished?i.outcome=p.INSIDE:i.outcome=this.guess(e);else if(a(e,E)&&!this.gameHasFinished)i.outcome=p.DUPLICATE;else do{u(e,O)?(this.gameHasFinished||(E[s][m]="a"),i.path.push(JSON.parse(JSON.stringify(e))),i.outcome=p.ABSORBED):(o=JSON.stringify(e),(r=n(e,O,g))!==f.NONE&&(1===i.path.length?(this.gameHasFinished||(E[s][m]="r"),i.outcome=p.REFLECTED):r===f.REVERSED&&(i.path.push(JSON.parse(o)),i.path.push(JSON.parse(JSON.stringify(e)))))),i.outcome===p.NOTHING&&(e.move(),i.path.push(JSON.parse(JSON.stringify(e))),c(e,g)&&(e.position.row===s&&e.position.column===m?(this.gameHasFinished||(E[s][m]="r"),i.outcome=p.REFLECTED):(this.gameHasFinished||(this.numberOfRays++,E[e.position.row][e.position.column]=this.numberOfRays,E[s][m]=this.numberOfRays),i.outcome=p.PROPOGATED)))}while(i.outcome===p.NOTHING);return v?i.rayNumber=E[s][m]:(i.rayNumber=this.numberOfRays,i.outcome!==p.ABSORBED&&i.outcome!==p.REFLECTED&&i.outcome!==p.PROPOGATED||this.turns.push(i)),i},"function"==typeof define&&define.amd||("object"==typeof exports?(module.exports.SHOOT_RAY_OUTCOME=p,module.exports.BlackBoxModel=m,"test"===process.env.NODE_ENV&&(module.exports.BlackBoxModel._private={checkForDeflectedRay:n,createGrid:i,initialiseGrid:o,placeMarbleOnGrid:r,placeMarblesRandomlyOnGrid:s,rayAlreadyShot:a,rayHasHitMarble:u,rayHasRechedRim:c,rayIsInCorner:l,rayIsInsideGrid:h,rayIsOutsideGrid:d})):(e=e||{},e.BLACKBOX=e.BLACKBOX||{},e.BLACKBOX.SHOOT_RAY_OUTCOME=p,e.BLACKBOX.Model=m))}(this,this.BLACKBOX),function(e,t,n){"use strict";function i(e){if(l){var t,n,o,r,s;s=document.getElementById("svg"),null!==s&&(r=a(s.querySelectorAll("path")),r.length>0&&(n=r.map(function(e){var t=e.getTotalLength();return e.style.strokeDasharray=t+" "+t,e.style.strokeDashoffset=t,e.style.visibility="visible",.03*Math.pow(t,.5)}),t=0,r[0].getBoundingClientRect(),e&&r.forEach(function(e,i){e.style.transition=e.style.WebkitTransition="stroke-dashoffset "+n[i]+"s "+t+"s ease-in-out",e.style.strokeDashoffset="0",t+=n[i]+.1}))),o=n.reduce(function(e,t){return e+t},.1*n.length+5),c=setTimeout(i,1e3*o,!e)}}function o(e,t){var n=e.path.length,i,o,r,s=[],a,u,c,l;if(n>2){a=100/t,u=a/2,i=e.path[0],c=i.position.row,l=i.position.column,s.push("M"),0===l?s.push(0):l===t+1?s.push(100):s.push((l-.5)*a),0===c?s.push(0):c===t+1?s.push(100):s.push((c-.5)*a);for(var h=1;h<e.path.length-1;h++)o=e.path[h],r=e.path[h+1],1===o.direction.rowIncrement&&1===r.direction.rowIncrement?(s.push("v"),s.push(a)):-1===o.direction.rowIncrement&&-1===r.direction.rowIncrement?(s.push("v"),s.push(-a)):1===o.direction.columnIncrement&&1===r.direction.columnIncrement?(s.push("h"),s.push(a)):-1===o.direction.columnIncrement&&-1===r.direction.columnIncrement?(s.push("h"),s.push(-a)):-1===o.direction.columnIncrement&&1===r.direction.rowIncrement?(s.push("a"),s.push(u),s.push(u),s.push(0),s.push(0),s.push(0),s.push(-u),s.push(u)):1===o.direction.rowIncrement&&1===r.direction.columnIncrement?(s.push("a"),s.push(u),s.push(u),s.push(0),s.push(0),s.push(0),s.push(u),s.push(u)):1===o.direction.columnIncrement&&-1===r.direction.rowIncrement?(s.push("a"),s.push(u),s.push(u),s.push(0),s.push(0),s.push(0),s.push(u),s.push(-u)):-1===o.direction.rowIncrement&&-1===r.direction.columnIncrement?(s.push("a"),s.push(u),s.push(u),s.push(0),s.push(0),s.push(0),s.push(-u),s.push(-u)):1===o.direction.columnIncrement&&1===r.direction.rowIncrement?(s.push("a"),s.push(u),s.push(u),s.push(0),s.push(0),s.push(1),s.push(u),s.push(u)):1===o.direction.rowIncrement&&-1===r.direction.columnIncrement?(s.push("a"),s.push(u),s.push(u),s.push(0),s.push(0),s.push(1),s.push(-u),s.push(u)):-1===o.direction.columnIncrement&&-1===r.direction.rowIncrement?(s.push("a"),s.push(u),s.push(u),s.push(0),s.push(0),s.push(1),s.push(-u),s.push(-u)):-1===o.direction.rowIncrement&&1===r.direction.columnIncrement&&(s.push("a"),s.push(u),s.push(u),s.push(0),s.push(0),s.push(1),s.push(u),s.push(-u))}return s.join(" ")}function r(e,i,o){var r=!(arguments.length>3&&arguments[3]!==n)||arguments[3],s=t.SHOOT_RAY_OUTCOME,a,u,c;switch(a=document.getElementsByTagName("svg")[0],u=document.createElement("path"),u.setAttribute("d",e),u.style.visibility=r?"visible":"hidden",""!==o&&u.setAttribute("class",o),i){case s.ABSORBED:case s.REFLECTED:-1===a.innerHTML.search(u.outerHTML)?a.innerHTML+=u.outerHTML:a.innerHTML=a.innerHTML.replace(u.outerHTML,"");break;case s.PROPOGATED:c=a.querySelectorAll("path."+o)[0],c===n?a.innerHTML+=u.outerHTML:c.remove();break}}function s(){var e,t,n,i,o,r,s;null!==(o=document.getElementById("svg"))&&(e=document.getElementById("blackbox"),t=parseInt(document.getElementById("inputGridSize").value),i=e.offsetWidth/(t+2),s=e.offsetWidth-2*i,r=e.offsetTop+i,n=i+e.offsetLeft,o.style.cssText="width: "+s+"px; top: "+r+"px; left: "+n+"px;")}function a(e){return Array.prototype.slice.call(e)}function u(){this.view=this,this.validationHandlers(),this.bind("resizeBlackBox")}var c,l=function(){var e=document.createElement("div");return e.innerHTML="<svg/>","http://www.w3.org/2000/svg"==(e.firstChild&&e.firstChild.namespaceURI)}();document.documentElement.className+=l?" inline-svg":"",u.prototype.bind=function(e,n){var i,o,r,a,u,c,l,h,d,m;"animateRays"===e?(h=document.getElementById("radioAnimateRaysYes"),h.addEventListener("change",function(){n()}),h=document.getElementById("radioAnimateRaysNo"),h.addEventListener("change",function(){n()})):"newGame"===e?(o=document.getElementById("buttonNewGame"),o.addEventListener("click",function(){c=parseInt(document.getElementById("inputGridSize").value),l=parseInt(document.getElementById("inputMarbles").value),n(c,l),document.getElementById("score").style.display="none",document.getElementById("animateRays").style.display="none"})):"scoreGame"===e?(r=document.getElementById("buttonScoreGame"),r.addEventListener("click",function(){m=n(),document.getElementById("scoreValue").innerHTML=m,document.getElementById("score").style.display="block",document.getElementById("animateRays").style.display="block"})):"shootRay"===e?(i=document.getElementById("blackbox"),i.addEventListener("click",function(e){a=e.target,"svg"!==a.nodeName&&(d=parseInt(a.dataset.pos.split(",")[0]),u=parseInt(a.dataset.pos.split(",")[1]),n(new t.Vector(d,u)))})):"resizeBlackBox"===e&&window.addEventListener("resize",s)},u.prototype.renderAndAnimateAllRays=function(e,n){var s=t.SHOOT_RAY_OUTCOME,u,l,h,d;return u="on"===document.querySelector('input[name="switch"]:checked').value,u?(h=document.getElementById("svg"),null!==h&&(l=a(h.querySelectorAll("path")),0===l.length&&e.forEach(function(e){var t;switch(e.outcome){case s.ABSORBED:t="hit";break;case s.MARBLE_PLACED:case s.MARBLE_REMOVED:t="guess";break;case s.PROPOGATED:t="ray-"+e.rayNumber;break;case s.REFLECTED:t="reflect";break}d=o(e,n),d.length>0&&r(d,e.outcome,t,!1)})),i(!0)):clearTimeout(c),u},u.prototype.renderGridConsole=function(e){var t;console.log();for(var n=0;n<e.length;n++){t="";for(var i=0;i<e.length;i++)t+=String(e[n][i])+"\t";console.log(t+"\t"+String(n))}},u.prototype.renderGrid=function(e,t,n,i,o,r){var a=document.getElementById("blackbox"),u,c,l,h=t+1;a.innerHTML="",a.className="blackbox grid grid-size-"+t;for(var d=0;d<=h;d++)for(var m=0;m<=h;m++){switch(c=document.createElement("div"),l=["cell"],e[d][m]){case 0:break;case"a":l.push("hit");break;case"n":l.push("guess-wrong");break;case"r":l.push("reflect");break;case"x":l.push("not-found");break;case"y":l.push("guess-right");break;default:0!==d&&d!==h&&0!==m&&m!==h||l.push("ray-"+e[d][m])}n&&r.forEach(function(t){parseInt(t.row)===d&&parseInt(t.column)===m&&0===e[d][m]&&l.push("guess")}),c.dataset.pos=d+","+m,c.className=l.join(" "),a.appendChild(c)}n&&(a.innerHTML+='<svg id="svg" viewBox="0 0 100 100"></svg>',window.setTimeout(s,0)),u=document.getElementById("buttonScoreGame"),u.disabled=!(i&&!n)},u.prototype.renderShot=function(e,n,i,s){var a=t.SHOOT_RAY_OUTCOME,u,c="",l,h,d,m,p;switch(m=e.path[0].position.row+","+e.path[0].position.column,h=e.path[e.path.length-1].position.row+","+e.path[e.path.length-1].position.column,d=document.querySelectorAll("[data-pos='"+m+"']")[0],l=document.querySelectorAll("[data-pos='"+h+"']")[0],u=document.getElementById("buttonScoreGame"),e.outcome){case a.ABSORBED:c="hit";break;case a.MARBLE_PLACED:case a.MARBLE_REMOVED:c="guess";break;case a.PROPOGATED:c="ray-"+e.rayNumber;break;case a.REFLECTED:c="reflect";break}if(i)p=o(e,n),p.length>0&&r(p,e.outcome,c);else switch(c=" "+c,e.outcome){case a.ABSORBED:case a.MARBLE_PLACED:case a.PROPOGATED:case a.REFLECTED:d.className+=c,e.outcome===a.PROPOGATED&&(l.className+=c);break;case a.MARBLE_REMOVED:d.className=d.className.replace(c,"");break}u.disabled=!(s&&!i)},u.prototype.validationHandlers=function(){var e=document.getElementById("inputGridSize"),t=document.getElementById("inputMarbles");e.addEventListener("focusout",function(e){var t=parseInt(e.currentTarget.value);t<6?e.currentTarget.value=6:t>16?e.currentTarget.value=16:isNaN(t)&&(e.currentTarget.value=8)}),t.addEventListener("focusout",function(e){var t=parseInt(document.getElementById("inputGridSize").value),n=parseInt(e.currentTarget.value);n<4?e.currentTarget.value=4:n>16?e.currentTarget.value=16:isNaN(n)&&(e.currentTarget.value=t-4)})},"function"==typeof define&&define.amd||("object"==typeof exports?module.exports.BlackBoxView=u:(e=e||{},e.BLACKBOX=e.BLACKBOX||{},e.BLACKBOX.View=u))}(this,this.BLACKBOX),function(e){"use strict";function t(e){e.animateRays=e.view.renderAndAnimateAllRays(e.model.turns,e.model.gridSize)}function n(e,t){var n=this;this.animateRays=!0,this.model=e,this.view=t,this.view.bind("animateRays",function(){n.onClickAnimateRays()}),this.view.bind("newGame",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;n.onClickNewGame(e,t)}),this.view.bind("scoreGame",function(){return n.onClickScoreGame()}),this.view.bind("shootRay",function(e){return n.onClickShootRay(e)})}n.prototype.onClickAnimateRays=function(){t(this)},n.prototype.onClickNewGame=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;this.model.newGame(e,t),this.renderViews()},n.prototype.onClickScoreGame=function(){var e=this.model.scoreGame();return this.renderViews(),this.animateRays&&setTimeout(t,3e3,this),e},n.prototype.onClickShootRay=function(e){var t=this.model.shootRay(e);this.view.renderShot(t,this.model.gridSize,this.model.gameHasFinished,this.model.allMarblesPlaced())},n.prototype.renderViews=function(){var e=this.model,t=JSON.parse(JSON.stringify(e.grid)),n=JSON.parse(JSON.stringify(e.guesses)),i=JSON.parse(JSON.stringify(e.marbles));this.view.renderGridConsole(t),this.view.renderGrid(t,e.gridSize,e.gameHasFinished,e.allMarblesPlaced(),n,i)},"function"==typeof define&&define.amd||("object"==typeof exports?module.exports.BlackBoxController=n:(e=e||{},e.BLACKBOX=e.BLACKBOX||{},e.BLACKBOX.Controller=n))}(this),function(e){"use strict";var t=new e.Model(8,4,!0),n=new e.View;new e.Controller(t,n).renderViews()}(this.BLACKBOX);
//# sourceMappingURL=./app.js.map